# 跨域

## 什么是跨域？

浏览器的同源策略 - 协议 http/https - 域名 - 端口
以上必须一致，否则视为跨域。

触发条件：

- 非同源
- 通过脚本发起请求： 如 Ajax、FetchApi
  目的：
  防止恶意网站窃取用户数据（cookie， localStorage 等）或发起攻击（xss）。

## jsonp

原理： 利用 script 标签的 src 属性可以跨域加载资源的特性。动态创建脚本请求数据，服务器返回包裹在回调函数中的数据，浏览器执行回调函数，从而实现跨域请求。

```js
const jsonp = (name) => {
  let script = document.createElement("script");
  script.src = `http://localhost:3000/api/jsonp?callback=${name}`;
  document.body.appendChild(script);
  return new Promise((resolve, reject) => {
    window[name] = (data) => {
      console.log("data:", data);
      resolve(data);
    };
  });
};

jsonp(`callback${new Date().getTime()}`).then((data) => {
  console.log("data2:", data);
  console.log(data);
});
```

## 前端代理

原理： 前端通过构建工具（如 webpack， vite）配置代理服务器，dev-server，将请求转发到后端服务器。

## 后端设置请求头 cors

服务器通过请求头，如 Access-Control-Allow-Origin 声明允许跨域的来源，浏览器据此判断是否放行。

## nginx 代理

nginx 通过反向代理解决跨域。
原理： 浏览器发送请求到 nginx ，nginx 再把请求转发到后端服务器。获取数据后返回给浏览器。

配置：

- 在 Nginx 配置文件中，使用 server 块监听特定端口。
- 利用 location 指令匹配需要代理的路径。
- 通过 proxy_pass 指令将请求转发到目标服务器

```nginx
server {
  listen 80;
  server_name localhost;

  location /api {
    proxy_pass URL_ADDRESS:3000;
  }
}
```
