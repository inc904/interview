# 预检请求

## 为什么会有预检请求？

预检请求的发生，来源于浏览器的跨域请求，浏览器对跨域的处理方式一般有两种：

- 浏览器限制客户端发起跨域请求
- 跨域请求正常发起，但是服务器返回的结果被浏览器拦截

一般情况下，跨域是产生第二种情况，服务器对数据已经进行了处理然后结果被浏览器拦截了，造成了请求失败。

所以为了避免这种情况，浏览器使用了 HTTP 的 OPTIONS 方法，发送了一个预检请求，预检请求成功之后才会发起真实的带数据的请求，否则阻止。

## 什么情况下发起预检请求

CORS 分为两种： 简单请求和非简单请求

简单请求：

- 使用 GET、POST、HEAD 方法之一
- Content-Type 的类型： application/x-www-form-urlencoded、multipart/form-data、text/plain
- HTTP 请求头使用 CORS 允许的安全字段：Accept、Accept-Language、Content-Language、DPR、Downlink、Save-Data、Viewport-Width、Width

非简单请求：

- 除了 GET、POST、HEAD 请求以外的其他请求
- Content-Type 的类型：不属于简单请求的类型的以外的类型
- HTTP 请求头： 除简单请求以外的字段

对于非简单请求，浏览器会使用 OPTIONS 方法发起预检请求，询问服务器是否支持该跨域请求，并请求服务器返回一下信息：

- Access-Control-Allow-Origin - 允许请求的来源域；
- Access-Control-Allow-Methods - 允许使用的 HTTP 方法；
- Access-Control-Allow-Headers - 允许使用的请求头字段；
- Access-Control-Max-Age - 验证结果的有效时间。

例如:

```js
Access-Control-Allow-Origin: http://www.example.com
Access-Control-Allow-Methods: GET, POST, PUT
Access-Control-Allow-Headers: X-Custom-Header
Access-Control-Max-Age: 86400
```

浏览器通过检查 OPTIONS 请求的返回结果，来判断是否允许发起真实的带数据的请求。
