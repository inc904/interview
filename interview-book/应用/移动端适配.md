# 移动端适配

## flexible 方案

[amfe-flexible](https://github.com/amfe/lib-flexible)

flexible.js 是手淘开发出的一个用来适配移动端的 js 框架。手淘框架的核心原理就是根据制不同的 width 给网页中 html 根节点设置不同的 font-size，然后所有的 px 都用 rem 来代替，这样就实现了不同大小的屏幕都适应相同的样式了。其实它就是一个终端设备适配的解决方案，也就是说它可以让你在不同的终端设备中实现页面适配。

```html
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />

<script src="./node_modules/amfe-flexible/index.js"></script>
```

```js
// 核心代码
function setRem() {
  // 通常设计稿是750px
  const baseSize = 75 // 基准值 750/10
  const scale = document.documentElement.clientWidth / 750
  document.documentElement.style.fontSize = baseSize * scale + 'px'
}
// 初始化
setRem()
// 窗口变化时重新设置
window.addEventListener('resize', setRem)
```

```js
;(function flexible(window, document) {
  // 获取的html 的根元素
  var docEl = document.documentElement
  // dpr 物理像素比
  //window.devicePixelRatio 当前浏览器物理像素比
  var dpr = window.devicePixelRatio || 1

  // adjust body font size  设置我们body 的字体大小
  function setBodyFontSize() {
    // 如果页面中有body 这个元素 就设置body的字体大小
    if (document.body) {
      document.body.style.fontSize = 12 * dpr + 'px'
    } else {
      // 如果页面中没有body 这个元素，则等着 我们页面主要的DOM元素加载完毕再去设置body 的字体大小
      // DOMContentLoaded   DOM元素加载后执行
      document.addEventListener('DOMContentLoaded', setBodyFontSize)
    }
  }
  setBodyFontSize()

  // set 1rem = viewWidth / 10    设置我们 html 元素的文字大小
  //   例如要转化为1rem=80px；将flexible.js中的10改为24，因为1920/24=80。
  function setRemUnit() {
    // html 宽度分为10等份
    var rem = docEl.clientWidth / 10
    docEl.style.fontSize = rem + 'px'
  }

  setRemUnit()

  // reset rem unit on page resize  当我们页面尺寸大小发生变化的时候，要重新设置下rem 的大小
  window.addEventListener('resize', setRemUnit)
  // pageshow 是我们重新加载页面触发的事件
  window.addEventListener('pageshow', function (e) {
    // e.persisted 返回的是true 就是说如果这个页面是从缓存取过来的页面，也需要从新计算一下rem 的大小
    if (e.persisted) {
      setRemUnit()
    }
  })

  // detect 0.5px supports  有些移动端的浏览器不支持0.5像素的写法
  if (dpr >= 2) {
    var fakeBody = document.createElement('body')
    var testElement = document.createElement('div')
    testElement.style.border = '.5px solid transparent'
    fakeBody.appendChild(testElement)
    docEl.appendChild(fakeBody)
    if (testElement.offsetHeight === 1) {
      docEl.classList.add('hairlines')
    }
    docEl.removeChild(fakeBody)
  }
})(window, document)
```

算好比例后 1rem 等于多少像素， 然后 直接写 px， 使用 插件（配合 VSCode 插件 cssrem） px 转 rem。

若需防止大屏下字体过大，可通过媒体查询限制 html 的 font-size

```css
@media (min-width: 750px) {
  html {
    font-size: 75px !important; /* 750px 设计稿基准 */
  }
}
```

## rem

rem 是相对单位，相对的是根元素，根元素默认是 16px，所以 1rem = 16px，1rem = 100%。

```css
/* 示例： 设计稿上的元素宽度为 200px */
.box {
  /* 假设 html 的 font-size 为 75px*/
  width: 2.667rem; // 200 / 75
  height: 1.333rem; // 100 / 75
}
```

## vm,vh

viewport 相对单位，更现代的方案
1vw = viewport width 的 1%
1vh = viewport height 的 1%

```css
/* 在 750px 的设计稿下，100px 转换为 (100/750*100vw) */
.container {
  width: 13.333vw;
  font-size: 4vw;
}
```

## rpx (小程序)

rpx 是微信小程序中的响应单位，规定屏幕宽度为 750rpx， 可以根据屏幕宽度进行自适应。

```css
/* 
    小程序内部转换逻辑
    const rpxRatio = windowWidth / 750;  // 屏幕宽度 / 750 得到转换比例
    const px = rpxRatio * rpx;  // rpx 转换为 px
*/
/* 在 750px 设计稿下 */
.box {
  width: 200rpx; /* 直接使用设计稿的 px 值 */
  height: 100rpx;
}
```
