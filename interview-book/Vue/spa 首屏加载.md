# spa 首屏加载速度慢怎么解决

首屏时间（first-contentful-paint），指的是浏览器从响应用户输入网址，到首屏内容渲染完成的时间
，此时整个网页不一定完全渲染完成，但是需要展示当前视窗需要的内容。

## 为什么慢？

- 网络延迟问题
- 资源文件体积是否过大
- 资源是否重复发送请求取加载了
- 加载脚本的时候，渲染内容堵塞了

## 如何解决？

常见的几种 SPA 首屏优化方式：

- 减少 入口文件体积
- 静态资源本地缓存
- UI 框架按需加载
- 图片资源的压缩
- 组件重复打包
- 开启 Gzip 压缩
- 使用 ssr

### 减少 入口文件体积

使用路由懒加载，把不同路由对应的组件分割成不同的代码块，待路由被请求的时候再加载对应组件，这样不会把所有组件都打包到一起，减小了首屏加载的体积。
vue-router 提供的 `component` 属性，可以传入一个函数，函数返回一个 Promise，当 Promise 状态变为 `resolve` 时，才会加载对应的组件。

### 静态资源本地缓存

后端发挥资源问题：

- 采用 HTTP 缓存，设置 `Cache-Control` 头，设置缓存过期时间，让浏览器缓存静态资源，减少请求次数。 Last-modified、Etag、Expires、Cache-Control、等响应头
- 使用 CDN，将静态资源上传到 CDN，让用户直接访问 CDN 上的静态资源，减少请求次数。
- 前端合理利用 local storage

### UI 框架按需加载

- 按需加载，减少首屏加载时间，提高用户体验。

### 组件重复打包

多个路由用到了 A.js，会造成重复下载

webpack 中 config 配置，修改 commonChunkPlugin 的 minChunks：3

minChunk： 3 表示：使用 3 次以上的包抽离出来，放在公共依赖文件，避免重复加载

### 图片资源压缩

- 适当压缩图片，减少网络请求，提高用户体验。
- icon，使用在线字体图标
- 使用 雪碧图，减小请求次数，提高用户体验

### 开启 Gzip 压缩

- vite-plugin-compress
- compression-webpack-plugin

## ssr

- 使用 ssr， 服务端渲染
- Nuxt.js 实现服务端渲染

## 总结

1. 资源加载优化

2. 页面渲染优化
